<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/iconfont.css">
		<link rel="stylesheet" href="../css/style.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.shop-select-all {
				position: fixed;
				bottom: 0px;
				left: 0px;
				right: 0px;
				background: white;
				height: 44px;
				line-height: 44px;
			}
			
			.submit-btn {
				width: 20%;
				float: left;
				background-color: DeepSkyBlue;
				text-align: center;
				color: #fff;
			}
			
			.cellImg {
				max-width: 70%;
				height: auto;
				vertical-align: middle;
				position: relative;
			}
			
			.mui-table-view .mui-table-view-cell {
				background: white;
				padding: 0px;
				height: 110px;
				margin-bottom: 7px;
			}
			
			.mui-table-view .mui-table-view-cell:after {
				left: 0px;
			}
			
			.mui-table-view:before {
				height: 0px;
			}
			
			.mui-table-view:after {
				height: 0px;
			}
			
			.leftClassCell {
				margin: 0 auto;
				padding-left: 1%;
				width: 32%;
				float: left;
				display: table-cell;
				line-height: 110px;
				vertical-align: middle;
			}
			
			.rightClassCell {
				padding-left: 5px;
				width: 40%;
				float: left;
				line-height: 110px;
			}
			
			.classCell {
				height: 100%;
				width: 100%;
				/*background: greenyellow;*/
				width: 28%;
				float: left;
				line-height: 70px;
				text-align: center;
			}
			
			.headSelect:visited {
				background-color: red;
			}
			
			.downDiv {
				background-color: white;
				height: 50px;
				width: 100%;
				/*网页底部*/
				position: fixed;
				bottom: 0;
			}
			
			.changeNum {
				padding: 0px;
				width: 30px;
				height: 30px;
				font-size: 30px;
			}
			/*.mui-icon.iconfont.icon-xuanze1 {
				font-size: 1.1em;
				color: darkgray;
			}
			
			.mui-icon.iconfont.icon-xuanze {
				font-size: 1.1em;
				color: orange;
				/*color: #41CEA9;*/
			/*}*/
			
			.head_title {
				vertical-align: baseline;
			}
			
			.mui-numbox {
				width: 90%;
				/*height: 100%;*/
				padding: 0px;
				border-width: 0px;
				line-height: 2em;
				margin-bottom: 80px;
				background-color: transparent;
			}
			
			.mui-numbox [class*=mui-numbox-btn] {
				width: 30%;
				height: 100%;
				font-size: 1em;
				background-color: white;
				/*padding-bottom: 0.3em;*/
				/*line-height:1.5em;*/
			}
			
			.itemName {
				color: black;
				line-height: 2em;
				margin-top: 10px;
			}
			
			.itemfeatures {
				font-size: 0.6em;
				line-height: 0.5em;
				padding-top: 3px;
			}
			
			.price {
				color: red;
				line-height: 1.0em;
				display: inline;
				/*padding-top: 0px;
				margin-top: 0px;*/
				/*padding-bottom: 10px;*/
			}
			
			.c_price {
				color: red;
				line-height: 1.0em;
				display: inline;
				color: #8F8F94;
				text-decoration: line-through;
				margin-left: 5px;
				/*padding-top: 10px;
				margin-top: 10px;
				padding-bottom: 10px;*/
			}
			
			.delete {
				color: orange;
				padding-top: 0px;
				margin-top: 0px;
				vertical-align: middle;
				/*margin-bottom: 10px;*/
				padding: 2.5px 12px;
				border-radius: 5px;
				border-color: orange;
			}
			
			.selectImg {
				color: deepskyblue;
			}
		</style>

	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="return_id" class="mui-icon mui-action-back mui-pull-left"></a>
			<h1 id="title" class="mui-title">购物车</h1>
		</header>
		<div id="net_error" class="notInfo_error" style="text-align: center; margin-top: 150px;display: none;">
			<img src="../images/ic_wifi_empty.png" style="height: 100px;" />
			<br />
			<span id="word" style="color: gray; font-size: 0.9em;">网络异常</span>
			<br />
			<button type="button" class="mui-btn own-btn-green" style="margin-top: 10px; padding: 5px 20px;">重新加载</button>
		</div>
		<div id="not_message" class="notInfo" style="text-align: center; margin-top: 200px;display: none;">
			<img src="../images/ic_data_empty.png" style="height: 100px;" />
			<br />
			<span id="word1" style="color: gray; font-size: 0.9em;"></span>
		</div>
		<div id="cart_item" class="cart_item" style="display: block;margin-bottom: 44px;margin-top: 44px;">
			<!--<ul class="mui-table-view">
				<li style="border-bottom: 1px solid #f4f4f4;padding-left: 10px;">
					<span id="productItem_' + index + '" onclick="stopEvt(event)" class="mui-icon iconfont icon-checknormal selectImg" style="padding-top:10px;padding-bottom:8px; font-size: 18px;"></span>
					<span id="productItem_' + index + '" class="mui-icon iconfont icon-dianpu" style="font-size: 20px;"></span>
					<label>店铺</label>
				</li>
				<li class="mui-table-view-cell mui-media">
					<div class="leftClassCell">
						<p style="display:inline;"><span id="productItem_' + index + '" onclick="stopEvt(event)" class="mui-icon iconfont icon-checknormal selectImg" style="padding: 5px;font-size: 18px;"></span></p>
						<img src="../images/bbys.png" class="cellImg" />
					</div>
					<div class="rightClassCell">
						<p id="name" class="itemName mui-ellipsis-2">' + item.c_name + '</p>
						<div style="line-height: 1.2em;">
							<p>规格：' + item.guige + '</p>
							<p class="price">' + '¥' + item.huiyuanprice + '</p>
						</div>
					</div>
					<div id=' + index + ' class="classCell"><button class="delete" onclick="deleteButton(this);stopEvt(event)">删除</button>
						<div id=' + index + ' class="mui-numbox" data-numbox-min=' + 1 + '>
							<button id="nnn" href="#" onclick="minusButton(this);stopEvt(event)" class="mui-btn mui-numbox-btn-minus" type="button">-</button>
							<input id="numbox' + index + '" class="mui-numbox-input" readonly="readonly" onclick="stopEvt(event)" type="number" value="1" />
							<button id="nn" href="#" onclick="addButton(this);stopEvt(event)" class="mui-btn mui-numbox-btn-plus" type="button">+</button>
						</div>
					</div>
				</li>
			</ul>-->
		</div>
		<div class="shop-select-all" style="display: none;">
			<div class="selectAll" style="width: 25%;float: left;">
				<span id="bar_icon" class="mui-icon iconfont icon-checknormal selectImg" style="font-size: 18px;padding-left: 10px;vertical-align: middle;"></span>
				<label style="color: gray;margin-right: 25%;font-size: 17px;vertical-align: middle;">全选</label>
			</div>
			<div style="width: 55%;float:left;padding-left: 40px;">
				<p style="display:inline;color: #5C5C5C;;font-size: 13px;">合计:</p>
				<p id="member-price" style="display:inline;color: red;font-size: 13px;">¥0.00</p>
			</div>
			<div class="submit-btn" style="">结算</div>

		</div>
	</body>
	<script src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/own.js"></script>
	<script src="../js/common.js"></script>
	<script src="../../js/common.js"></script>
	<script src="../../js/app.js"></script>
	<script src="../js/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script>
	<!--<script type="text/javascript" src="../js/wl_ajax.js"></script>-->
	<script type="text/javascript" charset="utf-8">
		mui.init({
			swipeBack: false
		});
		var storeArray = [];
		var dataListArray = [];
		var dingdanListArray = [];
		var cartSupplierItem = [];
		var mapNormal = [];
		var calResultFromServer = [];
		var AllCuxiaoResultList = [];
		var mapResult = [];
		var proResult = [];
		var list = [];
		var map = [];
		var cartWebview; //当前购物车webview
		var needlogin; //需要登录的div
		var userInfo;
		var userInfo_json;
		var yizhan_info;
		var yuanshijiage;
		var wait;
		var downDiv = document.querySelector('.downDiv');
		var mem_price = document.getElementById('member-price');
		var loginDiv = document.querySelector('.cart_item');
		var creater_id;
		var total_price;
		
		(function($) {
			$.oldBack = mui.back;
			$.back = function(event) {
				if(mui.os.android) {
					var tabindex = plus.webview.getWebviewById('./Shoppingmall/shop-main.html');
					mui.fire(tabindex, 'gohome');
				} else {
					plus.runtime.quit();
				}
			};
		})(mui);


		mui.plusReady(function() {
			cartWebview = plus.webview.currentWebview();
			var data = app.getDatas(SHOPACCOUNT);
			creater_id = data.type + "_" + data.xiaoqu + "_" + data.id;
			console.log("jjjj=" + JSON.stringify(data))
			pingtai = data.type;
			if(chkNetStatus() == "OK") {
				load_listview(creater_id);
			} else
				document.querySelector('#net_error').style.display = 'block';
			document.querySelector('.notInfo_error button').addEventListener('tap', function() {
				load_listview(creater_id);
			}, false);

			//			document.getElementById("return_id").addEventListener('tap', function() {
			//				console.log("----return_id--------");
			//				if(mui.os.ios) {
			//					console.log("----mui.os.ios-------");
			//					var tabindex = plus.webview.getWebviewById('tab-index');
			//					mui.fire(tabindex, 'gohome');
			//				}
			//
			//			}, false);

			mui('.shop-select-all').on('tap', '.selectAll', function() {
				selectAllItem(this);
			});

			mui('.shop-select-all').on('tap', '.submit-btn', function() {
				//	if(yizhan_info.flag != 4) {
				console.log("good=" + dingdanListArray.length)
				if(total_price > 0) {
					if(dingdanListArray.length >= 2) {
						mui.toast("不同商家不能同时付款！");
					} else {
						mui.openWindow({
							url: 'cartquerendingdan.html',
							id: 'cartquerendingdan.html',
							show: {
								autoShow: true,
								aniShow: "slide-in-right",
								duration: 100
							},
							waiting: {
								autoShow: false,
								title: '正在加载...'
							},
							extras: {

								"goodsDetail": dingdanListArray,
								"total_price": total_price.toFixed(2),
								"creater_id": creater_id,
								"pingtai": pingtai
							}
						});
					}

				} else {
					mui.toast("请先选择要结算的商品");
				}

				//}
				//				else {
				//					var btnArray = ['暂不注册', '注册会员'];
				//					mui.confirm('抱歉，游客模式不能购买商品，请先注册会员', '温馨提示', btnArray, function(e) {
				//						if(e.index == 1) {
				//							mui.openWindow({
				//								url: '../../reg.html',
				//								id: 'reg.html',
				//								show: {
				//									aniShow: 'slide-in-right',
				//									duration: 300
				//								},
				//								styles: {
				//									popGesture: 'hide'
				//								},
				//								waiting: {
				//									autoShow: true
				//								}
				//							});
				//							//							plus.webview.currentWebview().close();
				//						} else {
				//							//													console.log("不注册");
				//						}
				//					});
				//				}

			});

		});

		window.addEventListener('addsuccess', function() {
			console.log("add success!!!!!");
			load_listview(creater_id);
		}, false);
		window.addEventListener('refresh', function() {
			//	console.log("trigger====!!!" + mendianNum + " " + yizhan_info.xiaoqu + " " + yizhan_info.id)
			userInfo = app.getDatas(PREFERENCE_USER);
			yizhan_info = eval(userInfo);
			mendianNum = localStorage.getItem(SELECTED_YIZHAN_PREFIX);
			mem_price.innerText = '¥0.00';
			load_listview(creater_id);
		});

		function load_listview(createrId) {
			if(chkNetStatus() == "OK") {
				//	wait = plus.nativeUI.showWaiting("正在加载，请稍候...");
				load_query(createrId);
			} else {
				document.querySelector('#net_error').style.display = 'block';
				document.querySelector('.cart_item').style.display = 'none';
				document.querySelector('.shop-select-all').style.display = 'none';
			}
		}

		function load_query(createrId) {
			//console.log("value:" + "xiaoqu=" + mendianNum + " shequ=" + xiaoqu + " userid=" + userId)
			storeArray = null;
			storeArray = [];
			mui.ajax(QUERY_CART_URL, {
				data: {
					creater_id: createrId
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				success: function(data) {
					var info = JSON.stringify(data);
					var obj = eval(data);
					console.log("gouwuche===" + info);
					if(obj.success == 1) {
						//	wait.close();
						document.querySelector('#net_error').style.display = 'none';
						document.querySelector('#not_message').style.display = 'none';
						document.querySelector('.shop-select-all').style.display = 'block';
						document.querySelector('.cart_item').style.display = 'block';
						for(var i = 0; i < obj.gouwuche_info.length; i++) {
							dataListArray = null;
							dataListArray = [];
							var item = null;
							item = {};
							item.shangjia_id = obj.gouwuche_info[i].shangjia_id;
							item.shangjia_name = obj.gouwuche_info[i].shangjia_name;
							var shangpin_info = obj.gouwuche_info[i].shangpin_info;
							for(var j = 0; j < shangpin_info.length; j++) {
								var dataItem = {};
								dataItem.gouwuche_id = shangpin_info[j].gouwuche_id;
								dataItem.shangpin_id = shangpin_info[j].shangpin_id;
								dataItem.shangpin_bianhao = shangpin_info[j].shangpin_bianhao;
								dataItem.shangpin_shuliang = shangpin_info[j].shangpin_shuliang;
								dataItem.shangpin_name = shangpin_info[j].shangpin_name;
								dataItem.shangpin_guige = shangpin_info[j].shangpin_guige;
								dataItem.shangpin_jiage = shangpin_info[j].shangpin_jiage;
								dataItem.kuaidifei = shangpin_info[j].youfei;
								if(shangpin_info[j].hpic0 == '') {
									dataItem.picstr = "../../images/ic_launcher.png";
								} else {
									var picstr = shangpin_info[j].hpic0;
									var ss = [];
									ss = picstr.split("/");
									picstr = ss[1] + "/" + ss[2] + "/" + ss[3];
									dataItem.pic = SHOP_PICTURE_URL + picstr;
								}
								dataListArray.push(dataItem);
							}
							item.goodslist = dataListArray;
							storeArray.push(item);
						}
						setHtml(storeArray);
						addTop();

					} else {
						//	wait.close();
						mem_price.innerText = "¥0.00";
						document.querySelector('.cart_item').style.display = 'none';
						document.querySelector('#net_error').style.display = 'none';
						document.querySelector('.shop-select-all').style.display = 'none';
						document.querySelector('#not_message').style.display = 'block';
						//var queryResultMsg = obj.errorMsg;
						var queryResultMsg = "购物车为空！";
						console.log("hhhhhh" + queryResultMsg);
						if(queryResultMsg == '') {
							document.getElementById('word1').innerHTML = "获取数据失败";
						} else {
							document.getElementById('word1').innerHTML = queryResultMsg;
						}
					}
				},
				error: function(xhr, type, errorThrown) {
					console.log("ppppppppppppppppppppppp")
					//wait.close();
					document.querySelector('#not_message').style.display = 'none';
					document.querySelector('.cart_item').style.display = 'none';
					document.querySelector('.shop-select-all').style.display = 'none';
					document.querySelector('#net_error').style.display = 'block';
					mui.toast("网络异常");
				}
			});
		}

		function addTop() {
			mui('.mui-table-view').on('tap', 'li span', function() {
				selectItem(this);
			});
			mui('.mui-table-view').on('tap', 'li label', function() {
				selectTitleItem(this);
			});

		}

		function minusButton(o) {
			dingdanListArray = [];
			var inputNumbox;
			var id = o.id.split("_")[1] + "_" + o.id.split("_")[2];
			//console.log("idDDDDDD=" + id)
			inputNumbox = document.getElementById('numbox_' + id);
			var num = parseInt(inputNumbox.value);
			num -= 1;
			if(num < 1) {
				num = 1;
				mui.toast("购买数量不能低于1件");
			}
			inputNumbox.value = num;
			inputNumbox = document.getElementById('numbox_' + id);
			storeArray[o.id.split("_")[1]].goodslist[o.id.split("_")[2]].shangpin_shuliang = inputNumbox.value;
			refreshPopView();
			//	}
		}

		function addButton(o) {
			dingdanListArray = [];
			var inputNumbox;
			var id = o.id.split("_")[1] + "_" + o.id.split("_")[2];
			console.log("id=" + id)
			inputNumbox = document.getElementById('numbox_' + id);
			var num = parseInt(inputNumbox.value);
			console.log("oooohhh=" + num)
			//			if(num >= dataListArray[o.parentNode.id].kucun) {
			//				mui.toast("库存不足");
			//			} else
			num += 1;
			console.log("num=" + num)
			inputNumbox.value = num;
			inputNumbox = document.getElementById('numbox_' + id);
			storeArray[o.id.split("_")[1]].goodslist[o.id.split("_")[2]].shangpin_shuliang = inputNumbox.value;
			refreshPopView();
			//	}
		}

		function deleteButton(o) {
			var index = o.parentNode.parentNode.parentNode.id;
			var btnArray = ['否', '是'];
			mui.confirm('确认删除？', '', btnArray, function(e) {
				if(e.index == 1) {
					if(chkNetStatus() == "OK") {
						deleteItem(storeArray[index].goodslist[o.parentNode.id].gouwuche_id);
					} else
						mui.toast("网络异常");
				} else {

				}
			})
		}

		function itemButton(e) {
			console.log("index=" + e.id + "parent_id=" + e.parentNode.id)
			//			mui.openWindow({
			//				url: '../store/goodsListItemDetail.html',
			//				id: 'goodsListItemDetail.html',
			//				show: {
			//					autoShow: true,
			//					aniShow: "slide-in-right",
			//					duration: 100
			//				},
			//				waiting: {
			//					autoShow: false,
			//					title: '正在加载...'
			//				},
			//				extras: {
			//					"pingtai": pingtai,
			//					"createrid": creater_id,
			//					//	"cuxiaofanganbianhao": cuxiaofanganbianhao
			//				}
			//			});

		}

		function stopEvt(event) {
			event.stopPropagation(); //阻止点击事件向上冒泡  
		}

		function deleteItem(cartId) {
			//console.log("bianhao===" + bianhao)
			var arr = [];
			var item = {};
			item.gouwuche_id = cartId;
			arr.push(item);
			mui.ajax(DELETE_CART_URL, {
				data: JSON.stringify(arr),
				async: false,
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				header: {
					'Content-Type': 'application/json'
				},
				success: function(data) {
					var info = JSON.stringify(data);
					var obj = eval(data);
					console.log("deleteInfo===" + info);
					if(obj.success == 1) {
						mui.toast("删除成功");
						if(dataListArray.length > 1) {
							load_listview(creater_id);
							refreshPopView();
						} else {
							load_listview(creater_id);
						}
					} else {
						deleteResultMsg = obj.errorMsg;
						if(deleteResultMsg == '')
							mui.toast("删除失败");
						else
							mui.toast(deleteResultMsg);

					}
				},
				error: function(xhr, type, errorThrown) {
					mui.toast("网络异常");
				}

			});

		}

		function setHtml(storeArray) {
			console.log("array=" + JSON.stringify(storeArray))
			mem_price.innerText = "¥0.00";
			document.getElementById("bar_icon").className = "mui-icon iconfont icon-checknormal selectImg";
			loginDiv.innerHTML = " ";
			var html = '';
			mui.each(storeArray, function(index, item) {
				var ids = index;
				html += '<ul id="' + index + '" class="mui-table-view">\
				<li style="border-bottom: 1px solid #e4e4e4;padding-left: 10px;">\
					<label id="storeItem_' + index + '" class="mui-icon iconfont icon-checknormal selectImg" style="padding-top:10px;padding-bottom:8px; font-size: 18px;"></label>\
					<label class="mui-icon iconfont icon-dianpu" style="font-size: 20px;"></label>\
					<label>' + item.shangjia_name + '</label>\
				</li>';
				mui.each(storeArray[index].goodslist, function(index, item) {
					html += '<li id="' + index + '" onclick="itemButton(this)" class="mui-table-view-cell mui-media">\
					<div class="leftClassCell">\
						<p style="display:inline;"><span id="productItem_' + ids + "_" + index + '" onclick="stopEvt(event)" class="mui-icon iconfont icon-checknormal selectImg" style="padding: 5px;font-size: 18px;"></span></p>\
						<img src="' + item.pic + '" class="cellImg" />\
					</div>\
					<div class="rightClassCell">\
						<p id="name" class="itemName mui-ellipsis-2">' + item.shangpin_name + '</p>\
						<div style="line-height: 1.2em;">\
							<p>规格：' + item.shangpin_guige + '</p>\
							<p class="price">' + '¥' + item.shangpin_jiage + '</p>\
						</div>\
					</div>\
					<div id="' + index + '" class="classCell"><button class="delete" onclick="deleteButton(this);stopEvt(event)">删除</button>\
						<div id=' + index + ' class="mui-numbox" data-numbox-min=' + 1 + '>\
							<button id="minus_' + ids + "_" + index + '" href="#" onclick="minusButton(this);stopEvt(event)" class="mui-btn mui-numbox-btn-minus" type="button">-</button>\
							<input id="numbox_' + ids + "_" + index + '" class="mui-numbox-input" readonly="readonly" onclick="stopEvt(event)" type="number" value="' + item.shangpin_shuliang + '" />\
							<button id="plus_' + ids + "_" + index + '" href="#" onclick="addButton(this);stopEvt(event)" class="mui-btn mui-numbox-btn-plus" type="button">+</button>\
						</div>\
					</div>\
				</li>';
				});
				html += '</ul>';
			});
			loginDiv.innerHTML = html;
		}

		function selectTitleItem(obj) {
			console.log("kkkkk===" + obj.id)
			var index = obj.id.split("_")[1];
			var isXuanze = document.getElementById(obj.id).classList.contains('icon-checknormal');
			if(isXuanze) {
				document.getElementById(obj.id).className = "mui-icon iconfont icon-checkedon selectImg";
				for(var i = 0; i < storeArray[index].goodslist.length; i++) {
					var id = "productItem_" + index + "_" + i;
					document.querySelector('#' + id).className = "mui-icon iconfont icon-checkedon selectImg";
				}
			} else {
				document.getElementById(obj.id).className = "mui-icon iconfont icon-checknormal selectImg";
				for(var i = 0; i < storeArray[index].goodslist.length; i++) {
					var id = "productItem_" + index + "_" + i;
					document.querySelector('#' + id).className = "mui-icon iconfont icon-checknormal selectImg";
				}
			}
			if(checkTitleItemState()) {
				document.querySelector('#bar_icon').className = "mui-icon iconfont icon-checkedon selectImg";
			} else
				document.querySelector('#bar_icon').className = "mui-icon iconfont icon-checknormal selectImg";
			refreshPopView();
		}

		function selectAllItem(obj) {
			console.log("array=" + JSON.stringify(storeArray))
			dingdanListArray = [];
			var isXuanze = document.getElementById("bar_icon").classList.contains('icon-checknormal');
			if(isXuanze) {
				document.getElementById("bar_icon").className = "mui-icon iconfont icon-checkedon selectImg";
				for(var i = 0; i < storeArray.length; i++) {
					var id = "storeItem_" + i;
					document.querySelector('#' + id).className = "mui-icon iconfont icon-checkedon selectImg";
					for(var j = 0; j < storeArray[i].goodslist.length; j++) {
						var id = "productItem_" + i + "_" + j;
						document.querySelector('#' + id).className = "mui-icon iconfont icon-checkedon selectImg";
					}
				}
			} else {
				document.getElementById("bar_icon").className = "mui-icon iconfont icon-checknormal selectImg";
				for(var i = 0; i < storeArray.length; i++) {
					var id = "storeItem_" + i;
					document.querySelector('#' + id).className = "mui-icon iconfont icon-checknormal selectImg";
					for(var j = 0; j < storeArray[i].goodslist.length; j++) {
						var id = "productItem_" + i + "_" + j;
						document.querySelector('#' + id).className = "mui-icon iconfont icon-checknormal selectImg";
					}
				}
			}
			refreshPopView();
		}

		function selectItem(obj) {
			dingdanListArray = [];
			var index = obj.parentNode.parentNode.parentNode.parentNode.id;
			var inputNumbox = document.getElementById('numbox_' + obj.id.split("_")[1] + "_" + obj.id.split("_")[2]);
			var dex = obj.id.split("_")[2];
			console.log("iddiddd=" + inputNumbox.value)
			storeArray[index].goodslist[dex].shangpin_shuliang = inputNumbox.value;
			var isXuanze = obj.classList.contains('icon-checknormal');
			console.log("oooo=" + isXuanze)
			if(isXuanze) {
				obj.className = "mui-icon iconfont icon-checkedon selectImg";
			} else {
				obj.className = "mui-icon iconfont icon-checknormal selectImg";
			}
			if(checkItemState(obj, index)) {
				document.querySelector('#storeItem_' + index).className = "mui-icon iconfont icon-checkedon selectImg";
			} else
				document.querySelector('#storeItem_' + index).className = "mui-icon iconfont icon-checknormal selectImg";
			refreshPopView();
		}

		function refreshPopView() {
			dingdanListArray = [];
			var shangpinList = [];
			for(var i = 0; i < storeArray.length; i++) {
				var item = {};
				var titleid = "storeItem_" + i;
				if($('#' + titleid).hasClass('icon-checkedon')) {
					dingdanListArray.push(storeArray[i]);
				} else {
					var dataItem = {};
					var a = [];
					dataItem.shangjia_id = storeArray[i].shangjia_id;
					dataItem.shangjia_name = storeArray[i].shangjia_name;
					for(var j = 0; j < storeArray[i].goodslist.length; j++) {
						var id = "productItem_" + i + "_" + j;
						if($('#' + id).hasClass('icon-checkedon')) {
							console.log("every====" + id)
							a.push(storeArray[i].goodslist[j]);
							dataItem.goodslist = a;
							shangpinList.push(dataItem);
							console.log("shangpinList====" + JSON.stringify(shangpinList))

						}
					}
					if(shangpinList.length > 0) {
						dingdanListArray = shangpinList;
					}
				}

			}
			console.log("dingdanListArraysssss=" + JSON.stringify(dingdanListArray));
			setTotalMoneyData(dingdanListArray);
		}

		function checkItemState(obj, index) {
			for(var i = 0; i < storeArray[index].goodslist.length; i++) {
				var id = "productItem_" + index + "_" + i;
				if($('#' + id).hasClass('icon-checknormal')) {
					return false;
				}
			}
			return true;

		}

		function checkTitleItemState() {
			console.log("length=" + JSON.stringify(storeArray))
			for(var i = 0; i < storeArray.length; i++) {
				var id = "storeItem_" + i;
				if($('#' + id).hasClass('icon-checknormal')) {
					return false;
				}
			}
			return true;

		}

		function setTotalMoneyData(orderArray) {
			total_price = 0;
			for(var i = 0; i < orderArray.length; i++) {
				var shangpin = orderArray[i].goodslist;
				for(var j = 0; j < shangpin.length; j++) {
					total_price += parseFloat(shangpin[j].shangpin_jiage * shangpin[j].shangpin_shuliang);
				}
			}
			mem_price.innerText = "¥" + total_price.toFixed(2);
		}
		window.addEventListener('submitSuccess', function() {
			load_listview(creater_id);
		});
		window.addEventListener('getInfo_cart', function() {
			var data = app.getDatas(SHOPACCOUNT);
			creater_id = data.type + "_" + data.xiaoqu + "_" + data.id;
			console.log("jjjj=" + JSON.stringify(data))
			pingtai = data.type;
			if(chkNetStatus() == "OK") {
				load_listview(creater_id);
			} else
				document.querySelector('#net_error').style.display = 'block';
		});
	</script>

</html>