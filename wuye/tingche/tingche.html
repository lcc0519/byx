<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/style.css">
		<link rel="stylesheet" href="../../css/css.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.mui-content {
				position: absolute;
				left: 0;
				right: 0;
				top: 0px;
				bottom: 0;
				width: 100%;
				height: 100%;
				background-color: #efeff4;
				/*border:1px solid red;*/
			}
			
			.mui-scroll-wrapper,
			.mui-scroll {
				background-color: #efeff4;
			}
			
			.head {
				height: 40px;
			}
			
			#head {
				line-height: 40px;
			}
			
			.head-img {
				width: 40px;
				height: 40px;
			}
			
			#head-img1 {
				position: absolute;
				bottom: 10px;
				right: 40px;
				width: 40px;
				height: 40px;
			}
			
			.body-a {
				/*text-align: center;*/
				line-height: 20px;
				vertical-align: center;
			}
			
			.mui-icon-checkmarkempty {
				color: white;
			}
			
			.about-img {
				margin-top: 30%;
				width: 120px;
				height: 120px;
				vertical-align: middle;
			}
			
			.detail_tupian img {
				width: 200px;
				height: 200px;
				/*vertical-align: middle;*/
			}
			
			.help_img {
				width: 100%;
				height: auto;
			}
			
			.mui-preview-image.mui-fullscreen {
				position: fixed;
				z-index: 20;
				background-color: #000;
			}
			
			.mui-preview-header,
			.mui-preview-footer {
				position: absolute;
				width: 100%;
				left: 0;
				z-index: 10;
			}
			
			.mui-preview-header {
				height: 44px;
				top: 0;
			}
			
			.mui-preview-footer {
				height: 50px;
				bottom: 0px;
			}
			
			.mui-preview-header .mui-preview-indicator {
				display: block;
				line-height: 25px;
				color: #fff;
				text-align: center;
				margin: 15px auto 4;
				width: 70px;
				background-color: rgba(0, 0, 0, 0.4);
				border-radius: 12px;
				font-size: 16px;
			}
			
			.mui-preview-image {
				display: none;
				-webkit-animation-duration: 0.5s;
				animation-duration: 0.5s;
				-webkit-animation-fill-mode: both;
				animation-fill-mode: both;
			}
			
			.mui-preview-image.mui-preview-in {
				-webkit-animation-name: fadeIn;
				animation-name: fadeIn;
			}
			
			.mui-preview-image.mui-preview-out {
				background: none;
				-webkit-animation-name: fadeOut;
				animation-name: fadeOut;
			}
			
			.mui-preview-image.mui-preview-out .mui-preview-header,
			.mui-preview-image.mui-preview-out .mui-preview-footer {
				display: none;
			}
			
			.mui-zoom-scroller {
				position: absolute;
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
				-webkit-box-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				left: 0;
				right: 0;
				bottom: 0;
				top: 0;
				width: 100%;
				height: 100%;
				margin: 0;
				-webkit-backface-visibility: hidden;
			}
			
			.mui-zoom {
				-webkit-transform-style: preserve-3d;
				transform-style: preserve-3d;
			}
			
			.mui-slider .mui-slider-group .mui-slider-item img {
				width: auto;
				height: auto;
				max-width: 100%;
				max-height: 100%;
			}
			
			.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
				width: 100%;
			}
			
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
				display: inline-table;
			}
			
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
				display: table-cell;
				vertical-align: middle;
			}
			
			.mui-preview-loading {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
			}
			
			.mui-preview-loading.mui-active {
				display: block;
			}
			
			.mui-preview-loading .mui-spinner-white {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-left: -25px;
				margin-top: -25px;
				height: 50px;
				width: 50px;
			}
			
			.mui-preview-image img.mui-transitioning {
				-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
				transition: transform 0.5s ease, opacity 0.5s ease;
			}
			
			@-webkit-keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			
			@keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			
			@-webkit-keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			
			@keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			.touxiang_img {
				display: block;
				vertical-align: middle;
				width: 3.8em;
				height: 3.8em;
				border-radius: 50%;
				/*border: 2px solid white;*/
				color: gray;
				float: left;
			}
			.help_img {
				width: 100%;
				height: auto;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color:DeepSkyBlue">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: white;"></a>
		    <h1 class="mui-title mui-center" style="color: white;">小区停车</h1>
		</header>
		<div class="mui-content mui-scroll">
			<!--显示详细信息-->
			<div class="headImg" style="display: none;">
				<div class="touxiang">
					<div>
						<img id="touxiang_img" src="" class="touxiang_img" style="display: none;"/>
						<span id="default_touxiangimg" class="mui-icon mui-icon-contact" style="font-size: 3.8em; color: cornflowerblue;"></span>
					</div>
					<span id="touxiangid"></span>
				</div>
			</div>
			<div id="neterror_id" class="neterror_cls" style="text-align: center; margin-top: 150px;display: none;">
				<img src="../images/ic_wifi_empty.png" style="height: 100px;" />
				<br />
				<span id="word" style="color: gray; font-size: 0.9em;">网络异常</span>
				<br />
				<button type="button" class="mui-btn mui-btn-warning" style="margin-top: 10px; padding: 5px 20px;">重新加载</button>
			</div>
			<div id="nulldata_id" class="nulldata_cls" style="text-align: center; margin-top: 150px;display: none;">
				<img src="../images/ic_data_empty.png" style="height: 100px;" />
				<br />
				<span id="word" style="color: gray; font-size: 0.9em;">暂无车位分布图</span>
				<br />
			</div>
			<div id="cheweituDiv" style="display: none;">
			</div>
			<div id="">
				<h5  style="margin: 10px;">车位管理:</h5>
			</div>
			<ul id="shebei_list" class="mui-table-view mui-table-view-chevron">
				<li id="cheweishenqing_id" class="mui-table-view-cell">
					<a  href="#" class="mui-navigate-right body-a">
					<img class=" mui-pull-left body-img"  src="../images/parking_accredit.png">
					<span class="body-span">车位申请</span></a>
				</li>
				<li id="tingchejilu_id" class="mui-table-view-cell">
					<a  href="#" class="mui-navigate-right body-a">
					<img class=" mui-pull-left body-img"  src="../images/parking_record.png">
					<span class="body-span" >停车记录</span></a>
				</li>
				<li id="cheweifenbu_id" class="mui-table-view-cell">
					<a  href="#" class="mui-navigate-right body-a">
					<img class=" mui-pull-left body-img"  src="../images/vibe_on.png">
					<span class="body-span" >车位分布</span></a>
				</li>
				
			</ul>
			<div id="">
				<h5  style="margin: 10px;">访客模式:</h5>
			</div>
			<div id="">
				<ul class="mui-table-view mui-table-view-chevron">
					<li id="fangkeyaoqingma_id" class="mui-table-view-cell">
						<a  href="#" class="mui-navigate-right body-a">
						<img class=" mui-pull-left body-img"  src="../images/little_qrcode.png">
						<span class="body-span">访客邀请码</span></a>
					</li>
				</ul>
				<ul class="mui-table-view mui-table-view-chevron">
					<li id="fangkejilu_id" class="mui-table-view-cell">
						<a  href="#" class="mui-navigate-right body-a">
						<img class=" mui-pull-left body-img"  src="../images/home_me_xiaoxitongzhi.png">
						<span class="body-span">访客记录</span></a>
					</li>
				</ul>
			</div>
		<div >
	</body>
	<script src="../js/mui.min.js"></script>
	<script src="../js/mui.previewimage.js"></script>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/mui.zoom.js"></script>
	<script >
			mui.init({
				statusBarBackground: '#f7f7f7',
				swipeBack:false //启用右滑关闭功能				
			});
				
			var cheweidiv;
			var public_obj;
		
			mui.plusReady(function() {
				
				//getUserInfor();
				
				public_obj=eval(app.getDatas(PUBLIC_USER));
				cheweidiv = document.getElementById('cheweituDiv');
				queryCheweituPic();
				
				document.querySelector('.neterror_cls button').addEventListener('tap', function() {
					cheweidiv = document.getElementById('cheweituDiv');
					queryCheweituPic();
				}, false);

			});
			
			function queryCheweituPic(){
				console.log("------queryCheweituPic-----------");
				if(chkNetStatus() != "OK") {
					showNeterrorView("网络异常");
					return;
				}	
	
				var w=plus.nativeUI.showWaiting("正在获取车位分布图...");
					
				console.log("-------queryCheweituPic------="+QUERY_CHEWEITU_URL);
				
				mui.ajax(QUERY_CHEWEITU_URL,{
					data:{
						xiaoqu:public_obj.xiaoqu_prefix
					},
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					success:function (data){
						w.close();	
						var infor=JSON.stringify(data);
						var obj=eval(data);
						console.log("-------queryCheweituPic--------="+infor);
						if (obj.success==1) {
							
							if(obj.pic=="undefined"||obj.pic==null){
								showNulldataView();	
							}
							else{
								showCheweituPic(obj);
							}
						} 
						else{
							showNeterrorView("网络异常");						
						}								
					},							
					error:function(xhr,type,errorThrown){
						w.close();
						showNeterrorView("网络异常");	
					}	
				});	
			}
			
			function showCheweituPic(info_obj){
	
				
								
				var categoryarray = [];
				var i=0;
				
				if(info_obj.pic.pic1!=""&&info_obj.pic.pic1!=undefined){
					var item = {};		
					item.id = i;
					
					var s = new Array();
					s = info_obj.pic.pic1.split("/");
					var picPath = BASE_URL + s[1] + "/" + s[2] + "/" + s[3];
					console.log("picPath:" + picPath);
					item.pic = BASE_URL + s[1] + "/" + s[2] + "/" + s[3];
					categoryarray[++i] = item;	
					
					document.querySelector('#nulldata_id').style.display = 'none';
					document.querySelector('#neterror_id').style.display = 'none';
					document.querySelector('.headImg').style.display = 'none';
					document.querySelector('#cheweituDiv').style.display = 'block';
					
					var html = "";
					mui.each(categoryarray, function(index, item) {
					html = html + 
						'<img src='+item.pic+' class="help_img mui-action-preview" data-preview-src="" data-preview-group="1"/>';
					});			
					cheweidiv.innerHTML=html;
					mui.previewImage();
				}
				else{
					document.querySelector('#nulldata_id').style.display = 'none';
					document.querySelector('#neterror_id').style.display = 'none';
					document.querySelector('#cheweituDiv').style.display = 'none';
					document.querySelector('.headImg').style.display = 'block';
					
					getUserInfor();
				}
			}
			
			function showNeterrorView(msg){
				document.querySelector('#cheweituDiv').style.display = 'none';
				document.querySelector('#nulldata_id').style.display = 'none';
				document.querySelector('#neterror_id').style.display = 'block';
				document.querySelector('.neterror_cls span').innerHTML = msg;
			}
					
			function showNulldataView(){
				document.querySelector('#cheweituDiv').style.display = 'none';
				document.querySelector('#neterror_id').style.display = 'none';
				document.querySelector('#nulldata_id').style.display = 'block';
			}
		
			function getUserInfor() {
				console.log("------getUserInfor-----------");
				user_obj=eval(app.getDatas(PREFERENCE_USER));
				var userid=user_obj.id;
				var touxiang = user_obj.touxiang;
				doc.getElementById("touxiangid").innerHTML="ID:"+userid;
			
				if(touxiang == null || touxiang == "") {
					document.getElementById('default_touxiangimg').style.display='block';
					document.getElementById("touxiang_img").style.display='none';
				} 
				else {
					document.getElementById('touxiang_img').style.display='block';
					document.getElementById("default_touxiangimg").style.display='none';
					var s = new Array();
					console.log(touxiang);
					s = touxiang.split("/");
					var touxiangPath = BASE_URL + s[1] + "/" + s[2] + "/" + s[3];
					console.log("touxiangPath:" + touxiangPath);
					document.getElementById('touxiang_img').src = touxiangPath;
				}
			}
			
			document.getElementById("cheweishenqing_id").addEventListener('tap', function() {
				console.log("============cheweishenqing_id==============");
				
				mui.openWindow({
					url: 'idlecheweilist.html',
					id: 'idlecheweilist.html',
					show: {
						aniShow: 'slide-in-right',
						duration: 300
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			document.getElementById("tingchejilu_id").addEventListener('tap', function() {
				console.log("============tingchejilu_id==============");
				
				mui.openWindow({
					url: 'tingcherecord.html',
					id: 'tingcherecord.html',
					show: {
						aniShow: 'slide-in-right',
						duration: 300
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			document.getElementById("cheweifenbu_id").addEventListener('tap', function() {
				console.log("============cheweifenbu_id==============");
				
				mui.openWindow({
					url: 'cheweifenbu.html',
					id: 'cheweifenbu.html',
					show: {
						aniShow: 'slide-in-right',
						duration: 300
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			document.getElementById("fangkeyaoqingma_id").addEventListener('tap', function() {
				console.log("============fangkeyaoqingma_id==============");
				
				mui.openWindow({
					url: '../menjin/fangkema.html',
					id: 'fangkema.html',
					show: {
						aniShow: 'slide-in-right',
						duration: 300
					},
					waiting: {
						autoShow: false
					}
				});
			});
			
			document.getElementById("fangkejilu_id").addEventListener('tap', function() {
				console.log("============fangkejilu_id==============");
				
				mui.openWindow({
					url: '../menjin/fangkejilu.html',
					id: 'fangkejilu.html',
					show: {
						aniShow: 'slide-in-right',
						duration: 300
					},
					waiting: {
						autoShow: false
					}
				});
			});
	</script>
</html>
