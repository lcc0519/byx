<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/css.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.mui-content {
				position: absolute;
				left: 0;
				right: 0;
				top: 20px;
				bottom: 0;
				width: 100%;
				height: 100%;
				background-color: #efeff4;
			}
			
			.head {
				height: 40px;
			}
			
			#head {
				line-height: 40px;
			}
			
			.head-img {
				width: 40px;
				height: 40px;
			}
			
			#head-img1 {
				position: absolute;
				bottom: 10px;
				right: 40px;
				width: 40px;
				height: 40px;
			}
			
			.body-a {
				/*text-align: center;*/
				line-height: 20px;
				vertical-align: center;
			}
			
			.mui-icon-checkmarkempty {
				color: white;
			}
			
			.about-img {
				margin-top: 30%;
				width: 120px;
				height: 120px;
				vertical-align: middle;
			}
			
			.mui-input-group .mui-input-row {
				height: 50px;
			}
			
			.mui-input-group .mui-input-row:after {
				position: absolute;
				right: 0;
				bottom: 0;
				left: 10px;
				right: 10px;
				height: 1px;
				content: '';
				-webkit-transform: scaleY(.5);
				transform: scaleY(.5);
				background-color: #c8c7cc
			}
			
			.mui-input-row label {
				padding: 0;
				height: 50px;
				line-height: 50px;
				text-align: center;
				vertical-align: middle;
			}
			
			.mui-input-row input {
				height: 50px;
				padding: 0;
				line-height: 50px;
				vertical-align: middle;
			}
			
			.tips {
				/*border:1px solid red;*/
				height: 80px;
				margin: 20px;
				text-align: center;
				vertical-align: middle;
			}
			
			.tips p {
				color: #323232;
				font-size: 18px;
				margin-bottom: 10px;
			}
			
			.zhifufangshi {
				margin-left: 10px;
			}
			
			.zhifufangshi_img {
				width: 50%;
				height: 100%;
			}
			
			.zhifuxuanze_img {
				margin-left: 5px;
				margin-top: 5px;
				margin-right: 5px;
				height: 20px;
				width: 20px;
			}
		</style>

	</head>

	<body>
		<header class="mui-navbar-inner mui-bar mui-bar-nav">
			<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav" ></span>
				</button>
			<h1 class="mui-center mui-title">会员卡申请</h1>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded mui-input-group">
				<div class="mui-input-row">
					<label>姓名</label>
					<input id="name" type="text" class="mui-input-clear mui-input" placeholder="请填写真实姓名" maxlength="10" onkeyup="CNletter(this,10)">
				</div>
				<div class="mui-input-row">
					<label>生日</label>
					<input id="birthday" type="number" class="mui-input-clear mui-input" placeholder="请填写生日" maxlength="8" onkeyup="onlyNum(this,8)">
				</div>
			</div>
			<div class="mui-content-padded" style="text-align: center;margin-top: 20px;">
				<p>生日填写格式：19800101</p>
				<p>请正确填写，会员生日当天有惊喜哦！</p><br />
				<p>申请会员卡需缴纳10元卡费，请选择支付方式</p>
			</div>
			<div id="zhifutype" class="mui-content-padded" style="margin-top: 20px;background-color: white;padding: 10px 10px;">
				支付方式
				<ul id="pay_type" class="mui-table-view mui-grid-view mui-grid-9" style="border: none;">
					<li id="zhifubao_sp" class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-4">
						<a href="#">
							<img class="zhifufangshi_img" src="../images/zhifufangshi_zhifubaozhifu.png" />
							<div>
								<img id="zhifubao_img" class="zhifuxuanze_img" src="../images/gouxuanok.png" />
							</div>
						</a>
					</li>
					<li id="weixin_sp" class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-4">
						<a href="#">
							<img class="zhifufangshi_img" src="../images/zhifufangshi_weixinzhifu.png" />
							<div>
								<img id="weixin_img" class="zhifuxuanze_img" src="../images/gouxuanno.png" />
							</div>
						</a>
					</li>
					<li id="yinlian_sp" class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-4">
						<a href="#">
							<img class="zhifufangshi_img" src="../images/zhifufangshi_yinlianzhifu.png" />
							<div>
								<img id="yinlian_img" class="zhifuxuanze_img" src="../images/gouxuanno.png" />
							</div>
						</a>
					</li>
				</ul>

			</div>
			<div class="mui-content-padded" style="margin-top: 30px;">
				<input id="shenqing" type="button" style="width: 100%; background-color: red;color: white;font-size: 18px;" value="申  请" />
			</div>

		</div>
	</body>
	<script src="../js/mui.min.js "></script>
	<script src="../js/app.js"></script>
	<script src="../js/common.js"></script>
	<script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
	<script>
		var user_obj = eval(app.getDatas(PREFERENCE_USER));
		var nameBox = document.getElementById('name');
		var birthBox = document.getElementById('birthday');
		var zhifubaoSp = document.getElementById('zhifubao_sp');
		var weixinSp = document.getElementById('weixin_sp');
		var yinlianSp = document.getElementById('yinlian_sp');
		var yinlianImg = document.getElementById('yinlian_img');
		var zhifubaoImg = document.getElementById('zhifubao_img');
		var weixinImg = document.getElementById('weixin_img');
		var phone;
		var wxChannel = null; // 微信支付  
		var aliChannel = null; // 支付宝支付  
		var channel = null; //支付通道	
		var pays = {};
		var self;
		var selectedFukuantype = 14;
		var total = 10;
		var thisYizhan = localStorage.getItem(SELECTED_YIZHAN_PREFIX);

		mui.init({
			//			swipeBack: true //启用右滑关闭功能
		});

		mui.plusReady(function() {
			window.addEventListener('successback', function() {
				console.log("huiyuankashenqing successback");
				Successback();
			});
			self = plus.webview.currentWebview();
			phone = self.phonenumber;
			var chaxunPage = plus.webview.getWebviewById('huiyuankachaxun.html');
			chaxunPage.close();
			plus.payment.getChannels(function(channels) {
				//var content=document.getElementById('paybtns');
				//		var info=document.getElementById('info');
				var txt = '支付通道信息：';
				for(var i in channels) {
					var channel = channels[i];
					if(channel.id == 'qhpay' || channel.id == 'qihoo') { // 过滤掉不支持的支付通道：暂不支持360相关支付
						continue;
					}
					pays[channel.id] = channel;
					txt += 'id:' + channel.id + ', ';
					txt += 'description:' + channel.description + ', ';
					txt += 'serviceReady:' + channel.serviceReady + '； ';
					//						var de=document.createElement('div');
					//						de.setAttribute('class', 'button');
					//						de.setAttribute('onclick', 'submitAndPay(this.id)');
					//						de.id=channel.id;
					//						de.innerText=channel.description+'支付';
					//						content.appendChild(de);

					//						checkServices(channel);

				}
				console.log(txt);
				//		info.innerText=txt;
			}, function(e) {
				outLine('获取支付通道失败：' + e.message);
			});

			document.getElementById('shenqing').addEventListener('tap', function() {
				console.log("shengqing tap:"+phone);
//				console.log("checkPhone(phone)---"+checkPhone(phone));
				if(checkPhone(phone)==1) {
					console.log("phone is not register");
					user_obj = eval(app.getDatas(PREFERENCE_USER));
					if(user_obj.huiyuanka != null && user_obj.huiyuanka != "") {
						mui.alert("您已申请会员卡，同一个手机号只能申请一张会员卡，请稍候查询会员卡信息");
					} else {
						if(nameBox.value == "" || birthBox.value == "") {
							mui.toast("申请信息填写不全，请检查");
							return;
						} else {
							if(yinlianImg.src.indexOf("/images/gouxuanok.png") > 0) {
								selectedFukuantype = 2;
								apply_pay();
							} else if(zhifubaoImg.src.indexOf("/images/gouxuanok.png") > 0) {
								selectedFukuantype = 14;
								apply_pay();
							} else if(weixinImg.src.indexOf("/images/gouxuanok.png") > 0) {
								selectedFukuantype = 15;
								apply_pay();
							} else {
								plus.nativeUI.alert('请选择支付方式');
							}
							console.log('type:' + selectedFukuantype);
							//				submitInfo();
						}
					}
				} else {
						console.log("phone is register");
				}

			});

			function checkPhone(phone) {
				var flag=0;
				if(phone != "" && phone.length == 11) {
					mui.ajax(Card_Phone_Check_URL, {
						data: JSON.stringify({
							Mobile: phone
						}),
						dataType: 'json', //服务器返回json格式数据
						type: 'post', //HTTP请求类型
						async:false,
						timeout: 10000, //超时时间设置为10秒；
						success: function(data) {
							var infor = JSON.stringify(data);
							console.log("infor:" + infor);
							var jsonobj = eval(data);
							if(jsonobj.success == 1) {
								console.log("success==1");
								flag=1;
							} else {
								var errMsg = jsonobj.errorMag;
								mui.alert(errMsg);
								
							}
						},
						error: function(xhr, type, errorThrown) {
							mui.toast("网络异常");
							console.log("erorr:" + type);
							console.log(xhr.status);
							console.log(xhr.readyState);
							console.log(xhr.response);
							
						}
					});
				} else {
					mui.alert("手机号不合法");
					
				}
				return flag;

			}

			function apply_pay() {
				var id = null;
				var pay_name;
				if(selectedFukuantype == 14) {
					id = 'alipay';
					pay_name = '支付宝';
				} else if(selectedFukuantype == 15) {
					id = 'wxpay';
					pay_name = '微信';
				} else if(selectedFukuantype == 2)
					id = 'china_unionpay';
				console.log("支付方式:" + id);
				//支付宝和微信支付
				if(id != null) {
					console.log("支付方式:" + id);
					if(id == 'alipay') {
						console.log("支付宝支付:" + id);
						AliPay(id);
					} else if(id == 'wxpay') {
						console.log("微信支付:" + id);
						//					mui.toast("暂不支持此支付通道");
						WeixinPay(id);
					} else if(id == 'china_unionpay') {
						UnionPay(id);
						//						mui.toast("暂不支持此支付通道");
					}
				} else {
					mui.toast('请选择支付方式');
				}
			}
			// 支付宝支付
			function AliPay(id) {
				if(checkServices(pays['alipay'])) {
					var PAYSERVER = VIP_Apply_ALIPAYSERVER;
					//				channel = aliChannel;
					//					var args;
					var order;
					if(chkNetStatus() == "OK") {
						w = plus.nativeUI.showWaiting("正在使用支付宝支付，请稍候...");
						// 请求支付订单	
						var xhr = new XMLHttpRequest();
						xhr.onreadystatechange = function() {
							switch(xhr.readyState) {
								case 4:
									w.close();
									if(xhr.status == 200) {
										console.log('----- 请求订单成功 -----' + xhr.responseText);
										//								console.log('----- channel -----' + channel.id);
										plus.payment.request(pays['alipay'], xhr.responseText, function(result) {
											console.log('----- 支付成功 -----');
											console.log(JSON.stringify(result));
											plus.nativeUI.alert('支付成功!', function() {
												Successback();
											});
										}, function(error) {
											console.log('----- 支付失败 -----');
											console.log('[' + error.code + ']：' + error.message);
											plus.nativeUI.alert('支付失败,请稍后重试');
											return;
										});
									} else {
										console.log('----- 请求订单失败 -----' + xhr.status);
										plus.nativeUI.alert('获取订单信息失败！');
									}
									break;
								default:
									break;
							}
						}
						console.log(PAYSERVER);
						xhr.open('POST', PAYSERVER, true);
						xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
						console.log('请求支付订单：' + PAYSERVER);
						var card_cost = '会员卡卡费';
						var trade_no = 'NC' + getRandom(); //new card
						var s = "total=" + total + "&subject=" + card_cost + "&body=" + card_cost + "&out_trade_no=" + trade_no;
						xhr.send(s);
					} else {
						mui.toast("网络异常");
					}
				}
			}

			//微信支付
			function WeixinPay(payid) {
				if(checkServices(pays['wxpay'])) {
					console.log("weixin");
					var ip = returnCitySN["cip"];
					//				channel = wxChannel;
					//				console.log(channel.id);

					if(chkNetStatus() == "OK") {
						console.log("OK");
						var wxtotal = total * 100;
						var card_cost = '会员卡卡费';
						var trade_no = 'NC' + getRandom(); //new card
						console.log(trade_no);
						var w = plus.nativeUI.showWaiting("正在使用微信支付，请稍候...");
						if(mui.os.ios) {
							console.log("ios--wx");
							//						mui.toast("ios--wx");
							mui.ajax(VIP_Apply_WXPAYSERVER_IOS, {
								data: {
									body: card_cost,
									attach: card_cost,
									out_trade_no: trade_no,
									total_fee: wxtotal,
									spbill_create_ip: ip
								},
								dataType: 'json', //服务器返回json格式数据
								type: 'post', //HTTP请求类型
								timeout: 10000, //超时时间设置为10秒；
								success: function(data) {
									w.close();
									var infor = JSON.stringify(data);
									console.log("infor:" + infor);
									var jsonobj = eval(data);
									var order = JSON.stringify({
										retcode: 0,
										retmsg: "ok",
										appid: jsonobj.appid,
										noncestr: jsonobj.noncestr,
										package: jsonobj.package,
										partnerid: jsonobj.partnerid,
										prepayid: jsonobj.prepayid,
										timestamp: jsonobj.timestamp,
										//sign:"650912A32AB1C74A5B19AEC4B00C4A5D"
										sign: jsonobj.sign
									});
									console.log("order:" + order);
									plus.payment.request(pays['wxpay'], order, function(result) {

										plus.nativeUI.alert('支付成功：感谢你的支持，我们会继续努力完善。', function() {
											Successback();
										}, '缴费');
									}, function(e) {
										mui.alert("支付失败，请稍后重试");
										console.log('[' + e.code + ']：' + e.message);
										return;
									});

								},
								error: function(xhr, type, errorThrown) {
									console.log("erorr:" + type);
									console.log(xhr.status);
									console.log(xhr.readyState);
									console.log(xhr.response);
									if(xhr.status == 200) {
										w.close();
										//								console.log("xhr.responseText++"+xhr.responseText);
										if(xhr.responseText.indexOf('商品支付中') >= 0) {
											plus.nativeUI.alert('支付失败：商品支付中或已支付完成...', function() {
												mui.back();
											}, '缴费');
											return;
										} else {
											console.log("失败:" + xhr.responseText);
											mui.alert("失败：" + xhr.responseText);
										}
										//							
									} else {
										console.log("获取订单信息失败");
										plus.nativeUI.alert('获取订单信息失败！', null, '缴费');
									}
								}
							});
						} else if(mui.os.android) {
							console.log("android--wx");
							mui.ajax(VIP_Apply_WXPAYSERVER, {
								data: {
									body: card_cost,
									attach: card_cost,
									out_trade_no: trade_no,
									total_fee: wxtotal,
									spbill_create_ip: ip
								},
								dataType: 'json', //服务器返回json格式数据
								type: 'post', //HTTP请求类型
								timeout: 10000, //超时时间设置为10秒；
								success: function(data) {
									w.close();
									var infor = JSON.stringify(data);
									console.log("infor:" + infor);
									var jsonobj = eval(data);
									var order = JSON.stringify({
										retcode: 0,
										retmsg: "ok",
										appid: jsonobj.appid,
										noncestr: jsonobj.noncestr,
										package: jsonobj.package,
										partnerid: jsonobj.partnerid,
										prepayid: jsonobj.prepayid,
										timestamp: jsonobj.timestamp,
										//sign:"650912A32AB1C74A5B19AEC4B00C4A5D"
										sign: jsonobj.sign
									});
									plus.payment.request(pays['wxpay'], order, function(result) {
										plus.nativeUI.alert('支付成功：感谢你的支持，我们会继续努力完善。', function() {
											Successback();
										}, '缴费');
									}, function(e) {
										mui.alert("支付失败，请稍后重试");
										console.log('[' + e.code + ']：' + e.message);
										return;
										//									mui.alert("支付失败" + e.message);
										//								payfailback(billno,attach);
										//								var errmsg = e.message.substr(e.message.indexOf("]")+1);
										//								plus.nativeUI.alert(errmsg,null,"支付失败");

										//							plus.nativeUI.alert('更多错误信息请参考支付(Payment)规范文档：http://www.html5plus.org/#specification#/specification/Payment.html', null, '支付失败：'+e.code);
									});
								},
								error: function(xhr, type, errorThrown) {
									console.log("erorr:" + type);
									console.log(xhr.status);
									console.log(xhr.readyState);
									console.log(xhr.response);
									if(xhr.status == 200) {
										w.close();
										//								console.log("xhr.responseText++"+xhr.responseText);
										if(xhr.responseText.indexOf('商品支付中') >= 0) {
											plus.nativeUI.alert('支付失败：商品支付中或已支付完成...', function() {
												mui.back();
											}, '缴费');
											return;
										} else {
											console.log("失败:" + xhr.responseText);
											mui.alert("失败：" + xhr.responseText);
										}
										//							
									} else {
										console.log("获取订单信息失败");
										plus.nativeUI.alert('获取订单信息失败！', null, '缴费');
									}
								}
							});
						}

					} else {
						mui.toast("网络异常");
						//						mui.alert("网络异常");
					}
				}
			}

			//银联支付
			function UnionPay(id) {
				var timestamp = new Date().getTime();
				console.log("testtime--" + timestamp);
				//				payurl="http://120.192.167.83/upacp_demo_b2c/Wuye_FrontConsume.php";
				var mytime = gettime();
				console.log("---mytime---" + mytime.toString());
				var attach = phone + "_" + thisYizhan; //电话_门店
				var orderid = "bc" + phone + timestamp;
				console.log("orderid---" + orderid + ",attach---" + attach);

				if(chkNetStatus() == "OK") {
					var w = plus.nativeUI.showWaiting("正在使用银联支付，请稍候...");
					mui.ajax(VIP_Apply_SERVER, {
						data: {
							merId: "898053573920001",
							orderId: orderid,
							txnTime: mytime,
							reqReserved: attach,
							txnAmt: total * 100
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'post', //HTTP请求类型
						timeout: 10000,
						success: function(data) {
							w.close();
							var infor = JSON.stringify(data);
							var obj = eval(data);
							console.log("---infor----" + infor);
							if(obj.success == true) {
								yinlianpage(mytime, orderid, attach, obj.msg);
							} else {
								if(obj.msg.indexOf('商品支付中') >= 0) {
									plus.nativeUI.alert('支付失败：商品支付中或已支付完成...', function() {
										mui.back();
									}, '缴费');
									return;
								}

							}

						},
						error: function(xhr, type, errorThrown) {
							w.close();
							console.log("error-------" + xhr.responseText);
							if(xhr.status == 200) {
								w.close();
								if(xhr.responseText.indexOf('商品支付中') >= 0) {
									plus.nativeUI.alert('支付失败：商品支付中或已支付完成...', function() {
										mui.back();
									}, '缴费');
									return;
								}
								//							
							} else {
								plus.nativeUI.alert('获取订单信息失败！', null, '缴费');
							}
						}
					});
				} else {
					mui.toast("网络异常");
				}
			}

			function yinlianpage(mytime, orderid, attach, htmlurl) {
				mui.openWindow({
					url: 'union_pay_VIPApply.html',
					id: 'union_pay_VIPApply.html',
					//					preload: true,
					show: {
						aniShow: 'pop-in'
					},
					styles: {
						popGesture: 'hide'
					},
					waiting: {
						autoShow: false
					},
					extras: {
						txnTime: mytime,
						orderId: orderid,
						attach: attach,
						htmlurl: htmlurl
					}
				});
			}

			function Successback() {
				var self = plus.webview.currentWebview();
				console.log("----self---" + self.id);
				//				self.hide();
				submitInfo();
			}

			function submitInfo() {
				console.log("yizhan:" + user_obj.stationno + "," + user_obj.id + "," + user_obj.xiaoqu + "," + phone + "," + nameBox.value + "," + birthBox.value);
				var wait = plus.nativeUI.showWaiting('会员卡申请中...');
				mui.ajax(Insert_Huiyuanka_URL, {
					data: JSON.stringify({
						station_no: user_obj.stationno,
						account: user_obj.id,
						xiaoqu: user_obj.xiaoqu,
						MobilePhone: phone,
						membername: nameBox.value,
						Birthday: birthBox.value,
						type: selectedFukuantype
					}),
					//contentType:"application/x-www-form-urlencoded; charset=utf-8",
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					success: function(data) {
						var infor = JSON.stringify(data);
						console.log(infor);
						var shenqingResultOBJ = eval(data);
						if(shenqingResultOBJ.success == 1) {
							console.log('VIP CardNo：' + shenqingResultOBJ.CardNo);
							//							mui.alert(shenqingResultOBJ.message);
							wait.close();

							shenqingSucess(shenqingResultOBJ); //re-add by rocky on 20170717
						} else {
							if(shenqingResultOBJ.errorMsg == "") {
								mui.toast("获取数据失败");
							} else {
								mui.toast(shenqingResultOBJ.errorMsg);
							}
							mui.alert("抱歉，申请会员卡失败，请联系管理员。给您带来不便敬请谅解，感谢您光临");
						}
					},
					error: function(xhr, type, errorThrown) {
						wait.close();
						mui.toast("网络异常");
						console.log("error type:" + type);
						console.log(xhr.status);
						console.log(xhr.readyState);
						console.log(xhr.response);
					}
				});
			}
		});
		//生成随机数
		function add0(m) {
			return m < 10 ? '0' + m : m;
		}

		function getRandom() {
			var date = new Date();
			var y = date.getFullYear();
			var m = date.getMonth() + 1;
			var d = date.getDate();
			var h = date.getHours();
			var min = date.getMinutes();
			var s = date.getSeconds();
			console.log(y + add0(m) + add0(d) + add0(h) + add0(min) + add0(s));
			return y + add0(m) + add0(d) + add0(h) + add0(min) + add0(s);
		}

		function shenqingSucess(shenqingResultOBJ) {
			saveBindMsg(shenqingResultOBJ);
			mui.alert("申请成功!\n\n" + shenqingResultOBJ.message);
			mui.openWindow({
				url: '../shop/mine/huiyuanka.html',
				id: 'huiyuanka.html',
				show: {
					aniShow: 'pop-in'
				},
				waiting: {
					autoShow: true,
					title: "正在加载..."
				}
			});
			self.hide();
		}

		function saveBindMsg(shenqingResultOBJ) {
			console.log("shenqingResultOBJ.CardNo---" + shenqingResultOBJ.CardNo);
			var data1 = app.getDatas(PREFERENCE_USER);
			data1.huiyuanka = shenqingResultOBJ.CardNo;
			app.setDatas(PREFERENCE_USER, data1);
			var data2 = app.getDatas(PREFERENCE_USER);
			console.log("--saveBindMsg---data1:" + JSON.stringify(data1) + "---data2:" + JSON.stringify(data2));
			//			mui.alert("--saveBindMsg---data1:"+JSON.stringify(data1)+"\n\ndata2:"+JSON.stringify(data2));
			//			console.log("--saveBindMsg---data1:"+data1+"---data2:"+data2);
		}
		mui('#pay_type').on('tap', '.mui-table-view-cell', function() {
			var subid = this.getAttribute("id");
			console.log("subpage id is: " + subid);
			if(subid == 'zhifubao_sp') {
				if(zhifubaoImg.src.indexOf("/images/gouxuanno.png") > 0) {
					var s = zhifubaoImg.src.replace("gouxuanno.png", "gouxuanok.png");
					zhifubaoImg.src = s;
					console.log("支付宝已勾选：" + s);
					var s1 = zhifubaoImg.src.replace("gouxuanok.png", "gouxuanno.png");
					yinlianImg.src = s1;
					weixinImg.src = s1;
				}
			} else if(subid == 'weixin_sp') {
				if(weixinImg.src.indexOf("/images/gouxuanno.png") > 0) {
					var s = weixinImg.src.replace("gouxuanno.png", "gouxuanok.png");
					weixinImg.src = s;
					var s1 = weixinImg.src.replace("gouxuanok.png", "gouxuanno.png");
					zhifubaoImg.src = s1;
					yinlianImg.src = s1;
				}
			} else {
				if(yinlianImg.src.indexOf("/images/gouxuanno.png") > 0) {
					var s = yinlianImg.src.replace("gouxuanno.png", "gouxuanok.png");
					yinlianImg.src = s;
					var s1 = yinlianImg.src.replace("gouxuanok.png", "gouxuanno.png");
					zhifubaoImg.src = s1;
					weixinImg.src = s1;
				}
			}
		});

		function checkServices(pc) {
			if(!pc.serviceReady) {
				var txt = null;
				switch(pc.id) {
					case 'alipay':
						txt = '检测到系统未安装“支付宝快捷支付服务”，无法完成支付操作，请先安装应用';
						break;
					default:
						txt = '系统未安装“' + pc.description + '”服务，无法完成支付，请先安装应用';
						break;
				}
				mui.alert(txt);
				return false;
			} else {
				return true;
			}
		}
		//		function amount(th){
		//			if(event.keyCode !=37 && event.keyCode != 39)
		//			th.value=th.value.replace(/\D/g,'');
		//			var len=th.value.length;
		//			if(len>8){
		//				console.log("th.value before:"+th.value);
		//				th.value=th.value.substr(0,8);
		//				console.log("th.value after:"+th.value);
		//			}
		//		}
	</script>

</html>